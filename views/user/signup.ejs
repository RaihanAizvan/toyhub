<%- include("./header-login") -%>

<div class="container mx-auto mt-36 px-4 mb-10 sm:px-6 lg:px-8">
    <div class="max-w-lg mx-auto bg-white p-8 rounded-lg shadow-lg transform hover:scale-[1.02] transition-transform duration-300">
        <div class="flex items-center justify-center mb-6">
            <div class="bg-green-500 p-3 rounded-full">
                <i class="fas fa-user text-white text-2xl"></i>
            </div>
        </div>
        <h2 class="text-3xl font-bold text-center text-gray-800 mb-2">Create Account</h2>
        <p class="text-center text-gray-600 mb-6">Please fill in your details</p>

        <% if (locals.message) { %>
            <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded">
                <p class="font-medium"><%= locals.message %></p>
            </div>
        <% } %>

        <div id="error-message" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded hidden">
            <p class="font-medium"></p>
        </div>

        <form action="/user/signup" method="post" class="space-y-6">
            <div class="relative">
                <label class="block text-gray-700 mb-2">
                    <i class="fas fa-user mr-2"></i>Name
                </label>
                <input type="text" id="name" name="name" value="<%= locals.name %>"
                    class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-300"
                    placeholder="Enter your name">
            </div>

            <div class="relative">
                <label class="block text-gray-700 mb-2">
                    <i class="fas fa-envelope mr-2"></i>Email
                </label>
                <input type="email" id="email" name="email" value="<%= locals.email %>"
                    class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-300"
                    placeholder="Enter your email">
            </div>

            <div class="relative">
                <label class="block text-gray-700 mb-2">
                    <i class="fas fa-phone mr-2"></i>Mobile Number
                </label>
                <div class="flex">
                    <span class="inline-flex items-center px-4 py-3 rounded-l-lg bg-gray-100 text-gray-600 border border-r-0">+91</span>
                    <input type="text" id="phone" name="phone_number" value="<%= locals.phone_number %>"
                        class="w-full px-4 py-3 border rounded-r-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-300"
                        placeholder="Enter your mobile number">
                </div>
            </div>

            <div class="relative">
                <label class="block text-gray-700 mb-2">
                    <i class="fas fa-lock mr-2"></i>Create Password
                </label>
                <input type="password" id="password" name="password"
                    class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-300"
                    placeholder="Enter your password">
                <i class="fas fa-eye absolute right-3 top-[60%] cursor-pointer" id="togglePassword1"></i>
            </div>

            <div class="relative">
                <label class="block text-gray-700 mb-2">
                    <i class="fas fa-lock mr-2"></i>Confirm Password
                </label>
                <input type="password" id="confirmPassword" name="confirmPassword"
                    class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-300"
                    placeholder="Confirm your password">
                <i class="fas fa-eye absolute right-3 top-[60%] cursor-pointer" id="togglePassword2"></i>
            </div>

            <button type="submit"
                class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transform hover:-translate-y-1 transition-all duration-300">
                <i class="fas fa-user-plus mr-2"></i>Create Account
            </button>
        </form>

        <div class="relative my-8">
            <div class="absolute inset-0 flex items-center">
                <div class="w-full border-t border-gray-300"></div>
            </div>
            <div class="relative flex justify-center text-sm">
                <span class="px-2 bg-white text-gray-500">Or continue with</span>
            </div>
        </div>

        <!-- Google authentication -->
        <div class="flex items-center justify-center">
            <a href="/auth/google" class="w-full">
                <button class="w-full flex items-center justify-center bg-white border border-gray-300 rounded-lg shadow-md px-6 py-3 text-sm font-medium text-gray-800 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transform hover:-translate-y-1 transition-all duration-300">
                    <svg class="h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-0.5 0 48 48" version="1.1">
                        <g id="Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="Color-" transform="translate(-401.000000, -860.000000)">
                                <g id="Google" transform="translate(401.000000, 860.000000)">
                                    <path d="M9.82727273,24 C9.82727273,22.4757333 10.0804318,21.0144 10.5322727,19.6437333 L2.62345455,13.6042667 C1.08206818,16.7338667 0.213636364,20.2602667 0.213636364,24 C0.213636364,27.7365333 1.081,31.2608 2.62025,34.3882667 L10.5247955,28.3370667 C10.0772273,26.9728 9.82727273,25.5168 9.82727273,24" id="Fill-1" fill="#FBBC05"></path>
                                    <path d="M23.7136364,10.1333333 C27.025,10.1333333 30.0159091,11.3066667 32.3659091,13.2266667 L39.2022727,6.4 C35.0363636,2.77333333 29.6954545,0.533333333 23.7136364,0.533333333 C14.4268636,0.533333333 6.44540909,5.84426667 2.62345455,13.6042667 L10.5322727,19.6437333 C12.3545909,14.112 17.5491591,10.1333333 23.7136364,10.1333333" id="Fill-2" fill="#EB4335"></path>
                                    <path d="M23.7136364,37.8666667 C17.5491591,37.8666667 12.3545909,33.888 10.5322727,28.3562667 L2.62345455,34.3946667 C6.44540909,42.1557333 14.4268636,47.4666667 23.7136364,47.4666667 C29.4455,47.4666667 34.9177955,45.4314667 39.0249545,41.6181333 L31.5177727,35.8144 C29.3995682,37.1488 26.7323182,37.8666667 23.7136364,37.8666667" id="Fill-3" fill="#34A853"></path>
                                    <path d="M46.1454545,24 C46.1454545,22.6133333 45.9318182,21.12 45.6113636,19.7333333 L23.7136364,19.7333333 L23.7136364,28.8 L36.3181818,28.8 C35.6879545,31.8912 33.9724545,34.2677333 31.5177727,35.8144 L39.0249545,41.6181333 C43.3393409,37.6138667 46.1454545,31.6490667 46.1454545,24" id="Fill-4" fill="#4285F4"></path>
                                </g>
                            </g>
                        </g>
                    </svg>
                    Continue with Google
                </button>
            </a>
        </div>

        <p class="mt-8 text-center text-gray-600">
            Already have an account? 
            <a href="/user/login" class="text-green-500 hover:text-green-700 font-semibold hover:underline transition-colors duration-300">
                Login here
            </a>
        </p>
    </div>
</div>

<%- include("./footer") -%>

<script>
    const togglePassword1 = document.querySelector('#togglePassword1');
    const password = document.querySelector('#password');

    const togglePassword2 = document.querySelector('#togglePassword2');
    const confirmPassword = document.querySelector('#confirmPassword');

    togglePassword1.addEventListener('click', function () {
        // Toggle the password visibility
        const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
        password.setAttribute('type', type);
        // Toggle the eye / eye-slash icon
        this.classList.toggle('fa-eye');
        this.classList.toggle('fa-eye-slash');
    });

    togglePassword2.addEventListener('click', function () {
        // Toggle the confirm password visibility
        const type = confirmPassword.getAttribute('type') === 'password' ? 'text' : 'password';
        confirmPassword.setAttribute('type', type);
        // Toggle the eye / eye-slash icon
        this.classList.toggle('fa-eye');
        this.classList.toggle('fa-eye-slash');
    });

    // Frontend validation
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        e.preventDefault();

        // Get form values
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;
        const password = document.getElementById('password').value;
        const confirmPass = document.getElementById('confirmPassword').value;

        // Check if all fields are filled
        if (!name || !email || !phone || !password || !confirmPass) {
            showError('All fields are required');
            return;
        }

        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            showError('Invalid email format');
            return;
        }

        // Phone validation (10-15 digits)
        const phoneRegex = /^[0-9]{10,15}$/;
        if (!phoneRegex.test(phone)) {
            showError('Invalid phone number format');
            return;
        }

        // Password validation (min 8 chars, at least 1 letter and 1 number)
        const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;
        if (!passwordRegex.test(password)) {
            showError('Password must be at least 8 characters long, contain one letter and one number');
            return;
        }

        // Confirm password match
        if (password !== confirmPass) {
            showError('Passwords do not match');
            return;
        }

        // If all validations pass, submit the form
        form.submit();
    });

    function showError(message) {
        const errorDiv = document.getElementById('error-message');
        errorDiv.querySelector('p').textContent = message;
        errorDiv.classList.remove('hidden');
        
        // Scroll to error message
        errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // Hide message after 5 seconds
        setTimeout(() => {
            errorDiv.classList.add('hidden');
        }, 5000);
    }
</script>
